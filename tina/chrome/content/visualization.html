<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xml:lang="en-GB" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Session</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="robots" content="index, follow">

    <!--<link type="text/css" rel="stylesheet" href="lib/js/jquery/css/jquery-ui-1.7.2.custom.css" />-->
    <link type="text/css" rel="stylesheet" href="lib/js/jquery/css/eggplant/jquery-ui-1.7.2.custom.css" />

    <link type="text/css" rel="stylesheet" href="lib/js/jquery/css/ui.selectmenu.css" />
    <link type="text/css" rel="stylesheet" href="lib/js/jquery/css/ui.button.css" />
    <link type="text/css" rel="stylesheet" href="lib/js/jquery/css/ui.autocomplete.css" />
    <!--<link type="text/css" rel="stylesheet" href="lib/js/jquery/css/customInput.jquery.css" />-->
    <link type="text/css" rel="stylesheet" href="lib/js/jquery/css/jqtransform.tina.css" media="all" />

	
    <script src="lib/js/jquery/jquery-1.3.2.min.js"           type="text/javascript" language="javascript"></script>
    <script src="lib/js/jquery/jquery-ui-1.7.2.custom.min.js" type="text/javascript" language="javascript"></script>
    <script src="lib/js/jquery/ui.selectmenu.js"              type="text/javascript" language="javascript"></script>
    <script src="lib/js/jquery/ui.button.js"                  type="text/javascript" language="javascript"></script>
    <script src="lib/js/jquery/ui.autocomplete.js"            type="text/javascript" language="javascript"></script>
    <!--<script src="lib/js/jquery/customInput.jquery.js"         type="text/javascript" language="javascript"></script>-->
    <script src="console.js"                                  type="text/javascript" language="javascript"></script>
    <script src="lib/js/jquery/jquery.jqtransform.js"         type="text/javascript" language="javascript"></script>

    <style type="text/css">	
     .ui-widget { font-size: 0.9em; }
	.fg-button { outline: 0; margin:0 4px 0 0; padding: .4em 1em; text-decoration:none !important; cursor:pointer; position: relative; text-align: center; zoom: 1; }
	.fg-button .ui-icon { position: absolute; top: 50%; margin-top: -8px; left: 50%; margin-left: -8px; }
	
	a.fg-button { float:left; }
	
	/* remove extra button width in IE */
	button.fg-button { width:auto; overflow:visible; }
	
	.fg-button-icon-left { padding-left: 2.1em; }
	.fg-button-icon-right { padding-right: 2.1em; }
	.fg-button-icon-left .ui-icon { right: auto; left: .2em; margin-left: 0; }
	.fg-button-icon-right .ui-icon { left: auto; right: .2em; margin-left: 0; }
	
	.fg-button-icon-solo { display:block; width:8px; text-indent: -9999px; }	 /* solo icon buttons must have block properties for the text-indent to work */	
	
	.fg-buttonset { float:left; }
	.fg-buttonset .fg-button { float: left; }
	.fg-buttonset-single .fg-button, 
	.fg-buttonset-multi .fg-button { margin-right: -1px;}
	
	.fg-toolbar { padding: .5em; margin: 0;  }
	.fg-toolbar .fg-buttonset { margin-right:1.5em; padding-left: 1px; }
	.fg-toolbar .fg-button { font-size: 0.7em;  }
 
	/*demo page css*/
	/*
	h2 { clear: both; padding-top:1.5em; margin-top:0; } 
	.strike { text-decoration: line-through; }
	*/
	background-color: #ffffff;

.vizframe {
   /* position:absolute;
    top:0px;
    left:0px;*/
    width:100%;
    height:820px;
    z-index:2;
    border: 0px;
    background-color: #ffffff;
    background: #ffffff;
     
}


.viztoolbariframe {
    position:absolute;
    top:600px;
    left:40px;
    width:980px;
    height:45px;
    background-color: #ffffff;
    background: #ffffff;
    border:solid 0px;
    z-index:1;
}

.viztoolbar {
    position:absolute;
    top:600px;
    left:40px;
    z-index:3;
}
    </style>
    <script type="text/javascript"> 
	$(function(){
		//all hover and click logic for buttons
		$(".fg-button:not(.ui-state-disabled)")
		.hover(
			function(){ 
				$(this).addClass("ui-state-hover"); 
			},
			function(){ 
				$(this).removeClass("ui-state-hover"); 
			}
		)
		.mousedown(function(){
				$(this).parents('.fg-buttonset-single:first').find(".fg-button.ui-state-active").removeClass("ui-state-active");
				if( $(this).is('.ui-state-active.fg-button-toggleable, .fg-buttonset-multi .ui-state-active') ){ $(this).removeClass("ui-state-active"); }
				else { $(this).addClass("ui-state-active"); }	
		})
		.mouseup(function(){
			if(! $(this).is('.fg-button-toggleable, .fg-buttonset-single .fg-button,  .fg-buttonset-multi .fg-button') ){
				$(this).removeClass("ui-state-active");
			}
		});
		
		$("#sliderzoom").slider({
            value:120,
            min: 1,
            max: 160,
            step: 2,
            slide: function(event, ui) {
                frame.contents().find('#tinaviz')[0].getSubApplet().setZoomValue(ui.value);
            }
        });
	});
    </script> 

</head>
<body>
    <script type="text/javascript">
$(function(){  
    var DIR_SERVICE = new Components.Constructor("@mozilla.org/file/directory_service;1", "nsIProperties");
    var path = (new DIR_SERVICE()).get("AChrom", Components.interfaces.nsIFile).path;
    var appletPath;
    if (path.search(/\\/) != -1) { appletPath = path + "\\content\\applet\\index.html" }
    else { appletPath = path + "/content/applet/index.html" }
    var appletFile = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
    appletFile.initWithPath(appletPath);
    var appletURL = Components.classes["@mozilla.org/network/protocol;1?name=file"].createInstance(Components.interfaces.nsIFileProtocolHandler).getURLSpecFromFile(appletFile);
    $('#container').append('<iframe id="vizframe" class="vizframe" allowtransparency="true" scrolling="no" width="100%" height="900" frameborder="0" src="'+appletURL+'"></iframe><iframe id="viztoolbariframe" class="viztoolbariframe"></iframe>'); 
                        // $('#vizframe').attr('src', 'http:LINK');
});
        </script>
    </div>
    <div class="search"> 
        <label for="searchfield">Search:</label> 
        <input id="searchfield" name="searchfield" /> 
    </div>
    <script type="text/javascript">
                
frame = $('#vizframe');
labels = [];

$(document).ready(function() {  
    //applet = $('#vizframe').contents().find('#tinaviz');
    frame = $('#vizframe');
    labels = [];
    $("#searchfield").autocomplete({
	    data: labels,
		extraSearch: function(term) {
		    frame.contents().find('#tinaviz')[0].getSubApplet().searchLabelDynamicFocus(term);
	    }
	});
			        
    // wait for the applet to be ready
	setTimeout("synchronize()",5000);
			        
	// wait for the applet to be ready
	// setTimeout("addToolbar()",2000); 
});
                
function synchronize() {
    labels = frame.contents().find('#tinaviz')[0].getSubApplet().getLabels();
    $("#searchfield").autocomplete("setData", {
	    data: labels
	});
}
                
function toggleLabels() {
    frame.contents().find('#tinaviz')[0].getSubApplet().toggleLabels();
}

function toggleNodes() {
    frame.contents().find('#tinaviz')[0].getSubApplet().toggleNodes();
}

function centerOnNodeByLabelRegex(regex) {
    frame.contents().find('#tinaviz')[0].getSubApplet().centerOnNodeByLabelRegex(regex);
}
   
function toggleLinks() {
    frame.contents().find('#tinaviz')[0].getSubApplet().toggleLinks();
}

function togglePosterOverlay() {
    frame.contents().find('#tinaviz')[0].getSubApplet().togglePosterOverlay();
}
                
function center() {
    frame.contents().find('#tinaviz')[0].getSubApplet().center();
}
                
function takePDFPicture() {
    var outputFilePath = "graph.pdf";
    var result;
    try {
        result = frame.contents().find('#tinaviz')[0].getSubApplet().takePDFPicture(outputFilePath);
    } catch (e) {
        //alert("Oops! Something bad just happened. Calling 911...");
        $('#debugdiv').append('<br><b>exception='+e+'</b>'); 
        console.log(e);
        return;
    }
    $('#debugdiv').append('<br>Saving to '+outputFilePath+'</p>'); 
    setTimeout("downloadFile('"+outputFilePath+"', 60)",1000);
}
                
function takePNGPicture() {
    var outputFilePath = "graph.png";
    var result;
    try {
        result = frame.contents().find('#tinaviz')[0].getSubApplet().takePNGPicture(outputFilePath);
    } catch (e) {
        //alert("Oops! Something bad just happened. Calling 911...");
        $('#debugdiv').append('<br><b>exception='+e+'</b>'); 
         console.log(e);
         return;
    }
    $('#debugdiv').append('<br>Saving to '+outputFilePath+'</p>'); 
    setTimeout("downloadFile('"+outputFilePath+"', 60)",1000);
}
                
function downloadFile(outputFilePath, timeout) {
    var DIR_SERVICE = new Components.Constructor("@mozilla.org/file/directory_service;1", "nsIProperties");
    var path = (new DIR_SERVICE()).get("AChrom", Components.interfaces.nsIFile).path;
    var downloadPath;
    if (path.search(/\\/) != -1) { downloadPath = path + "\\..\\"+outputFilePath }
    else { downloadPath = path + "/../"+outputFilePath  }
    var downloadFile = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
    downloadFile.initWithPath(downloadPath);
    if (downloadFile.exists() && timeout < 0) {
        window.location.href = Components.classes["@mozilla.org/network/protocol;1?name=file"].createInstance(Components.interfaces.nsIFileProtocolHandler).getURLSpecFromFile(downloadFile);
        return true;
   }
    if (downloadFile.exists() && timeout > 0) {
        setTimeout("downloadFile('"+outputFilePath+"', "+(-1)+")", 1000);
        return true;
    } else {
        // $('#debugdiv').append('<br>waiting..</p>'); 
        setTimeout("downloadFile('"+outputFilePath+"', "+(timeout -1)+")", 1000);
        return true;
    }
    return false;
}
                
function updateView() {
	            
    var filename = "test3.gexf";
    var DIR_SERVICE = new Components.Constructor("@mozilla.org/file/directory_service;1", "nsIProperties");
    var path = (new DIR_SERVICE()).get("AChrom", Components.interfaces.nsIFile).path;
    var gexfPath;
    if (path.search(/\\/) != -1) { gexfPath = path + "\\content\\data\\"+filename }
    else { gexfPath = path + "/content/applet/data/"+filename  }
    var gexfFile = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
    gexfFile.initWithPath(gexfPath);   
    var gexfURL = Components.classes["@mozilla.org/network/protocol;1?name=file"].createInstance(Components.interfaces.nsIFileProtocolHandler).getURLSpecFromFile(gexfFile);
    $('#debugdiv').append('<p>applet.updateView("'+gexfURL+'");'); 
    var result;
    try {
        result = frame.contents().find('#tinaviz')[0].getSubApplet().updateView(gexfURL);
        synchronize();
    } catch (e) {
        $('#debugdiv').append('<br/><b>== exception '+e+'</b>'); 
        console.log(e);
    }
        $('#debugdiv').append('<br/>== returned '+result+'</p>'); 
}
               
                /*
function loadNewViz(url) {

    // un seul import de composant xpcom
    var tina = Cc["Python.TinasoftAPI"].createInstance(Ci.nsITinasoftAPI);
    
    // key/value database ?
    //var key = "users/my_user_id/sessions/my_cool_session_id";
    //var key = "jbilcke_session124";
    var key = "my_session_unique_id";
    var session = tina.session(key);
    if (!session) {
       // TODO
       // "session not found, aborting..";
       // log the error
       return -1;
    } 
    // retourne un objet js/json de la forme:
    
    // session.id = ID de la session
    // session.name = nom de session lisible (affiché dans la barre de titre par exemple) 
    // session.owner = ID du propriétaire de la session
    // session.corpus = ID du corpus
    // session.bookmarks = ID de la collection de bookmarks
    // session.network = ID du graphe
    
    var user = tina.user(session.owner);
    if (!user) {
       // TODO
       // "session not found, aborting..";
       // log the error
       return -1;
    } 
    
    // user.id = user id, unique
    // user.name = nom de l'utilisateur 
    // 
    
        // session.id = session id, unique
    // session.name = nom de session lisible (affiché dans la barre de titre par exemple) 
    // session.owner = propriétaire de la session, sous forme de user_id
    // session.corpus
    var bookmarks = tina.bookmarks(session.bookmarks);
    if (!bookmarks) {
    
       // bookmarks est une liste de bookmark
       // TODO
       // "session not found, aborting..";
       // log the error
       return -1;
    } 
     
    var bookmarks = tina.bookmarks("bookmarks");
        
    // user.id = user id, unique
    // user.name = nom de l'utilisateur 
    // 
}
*/
    </script>
    <div id="container">
        <div id="viztoolbar" class="fg-toolbar ui-widget-header ui-corner-all ui-helper-clearfix viztoolbar"> 
        
	        <div class="fg-buttonset ui-helper-clearfix"> 
		        <a href="#" class="fg-button ui-state-default fg-button-icon-solo ui-corner-all" title="Open" onclick="updateView()"><span class="ui-icon ui-icon-folder-open"></span> Open</a> 
		        <a href="#" class="fg-button ui-state-default fg-button-icon-solo  ui-corner-all" title="Save" onclick="save()"><span class="ui-icon ui-icon-disk"></span> Save</a> 
		        <a href="#" class="fg-button ui-state-default fg-button-icon-solo  ui-corner-all" title="snapshot" onclick="snapshot()"><span class="ui-icon ui-icon-disk"></span> Snapshot</a> 
		        <a href="#" class="fg-button ui-state-default fg-button-icon-solo  ui-corner-all" title="Delete"><span class="ui-icon ui-icon-trash"></span> Delete</a> 
	        </div> 
	        
	        <div class="fg-buttonset ui-helper-clearfix"> 
		        <a href="#" class="fg-button ui-state-default fg-button-icon-solo ui-corner-all" title="Reset view" onclick="center()"><span class="ui-icon ui-icon-circle-zoomout"></span>reset view</a> 
	        </div> 
	        
	        <div class="fg-buttonset fg-buttonset-multi"> 
		        <button class="fg-button ui-state-active ui-corner-left" onclick="toggleLabels()">labels</button> 
		        <button class="fg-button ui-state-active" onclick="toggleNodes()">nodes</button> 
		        <button class="fg-button ui-state-active" onclick="toggleLinks()">links</button> 
		        <button class="fg-button ui-state-default  ui-corner-right" onclick="togglePosterOverlay()">overlay</button> 
	        </div>
	         
	        <div class="fg-buttonset ui-helper-clearfix"> 
	            <a href="#" class="fg-button ui-state-default fg-button-icon-solo  ui-corner-all" title="Print" onclick="takePDFPicture()"><span class="ui-icon ui-icon-print"></span> Picture</a> 
		        <a href="#" class="fg-button ui-state-default fg-button-icon-solo  ui-corner-all" title="Print"onclick="takePNGPicture()"><span class="ui-icon ui-icon-print"></span> PDF</a> 
		        <a href="#" class="fg-button ui-state-default fg-button-icon-solo  ui-corner-all" title="Print"><span class="ui-icon ui-icon-print"></span> Print</a> 
		        <a href="#" class="fg-button ui-state-default fg-button-icon-solo  ui-corner-all" title="Email"><span class="ui-icon ui-icon-mail-closed"></span> Email</a> 
	        </div> 
	        
	        <div class="fg-buttonset fg-buttonset-single ui-helper-clearfix"> 
		        <button class="fg-button ui-state-default ui-state-active ui-priority-primary ui-corner-left">project</button> 
		        <button class="fg-button ui-state-default ui-priority-primary">batch</button> 
		        <button class="fg-button ui-state-default ui-priority-primary ui-corner-right">worldwide</button> 
	        </div> 
	        
        </div> 
        <div id="debugdiv">
        </div> 
    </body>
</html>






